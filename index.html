<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Practicing</title>
    <style>
        :root {
            --primary: #2563eb; --secondary: #1e40af; --bg: #f8fafc;
            --text: #334155; --correct: #16a34a; --wrong: #dc2626; --warning: #f59e0b;
        }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); color: var(--text); }
        header { background: var(--primary); color: white; padding: 20px; text-align: center; }
        nav { display: flex; justify-content: center; background: var(--secondary); position: sticky; top: 0; z-index: 100; overflow-x: auto; }
        nav button { background: none; border: none; color: white; padding: 15px 20px; cursor: pointer; font-weight: 600; transition: 0.3s; }
        nav button:hover, nav button.active { background: rgba(255,255,255,0.2); }
        main { max-width: 1100px; margin: 20px auto; padding: 20px; }
        .section { display: none; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .section.active { display: block; animation: fadeIn 0.3s; }

        /* Tables & Search */
        .table-wrapper { overflow-x: auto; margin-top: 10px; max-height: 400px; border: 1px solid #ddd; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        th, td { border: 1px solid #e2e8f0; padding: 12px; text-align: left; }
        th { background: #eff6ff; position: sticky; top: 0; }
        .search-box { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; }

        /* Question Blocks */
        .question-block { padding: 15px; border-radius: 10px; border: 2px solid #f1f5f9; margin-bottom: 15px; }
        .unanswered { border-color: var(--warning); background-color: #fffbeb; }
        .options-list label { display: block; padding: 8px; cursor: pointer; border-radius: 6px; }
        .options-list label:hover { background: #eff6ff; }

        .btn { background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 5px; }
        .btn-reset { background: #64748b; }
        .result-box { display: none; margin-top: 20px; padding: 20px; border-radius: 10px; text-align: center; font-weight: bold; }
        
        /* History Style */
        .history-list { list-style: none; padding: 0; }
        .history-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<header>
    <h1>ENGLISH PRACTICING</h1>
    <p>H·ªá th·ªëng t·ª± h·ªçc Ng√¥n ng·ªØ Th√¥ng minh</p>
</header>

<nav>
    <button onclick="showTab('home')" class="nav-btn active">Ki·∫øn Th·ª©c</button>
    <button onclick="showTab('quiz')" class="nav-btn">Luy·ªán T·∫≠p</button>
    <button onclick="showTab('test')" class="nav-btn">Ki·ªÉm Tra</button>
    <button onclick="showTab('history')" class="nav-btn">L·ªãch S·ª≠</button>
</nav>

<main>
    <div id="home" class="section active">
        <h2>üìö Tra c·ª©u & Ng·ªØ ph√°p</h2>
        <input type="text" class="search-box" id="verbSearch" placeholder="T√¨m ƒë·ªông t·ª´ b·∫•t quy t·∫Øc (V1, V2, V3 ho·∫∑c nghƒ©a)..." onkeyup="searchVerbs()">
        <div class="table-wrapper">
            <table id="verbTable">
                <thead>
                    <tr><th>V1</th><th>V2</th><th>V3</th><th>Nghƒ©a</th><th>V√≠ d·ª•</th></tr>
                </thead>
                <tbody id="verbBody"></tbody>
            </table>
        </div>
    </div>

    <div id="quiz" class="section">
        <h2>üìù Quiz Ng·∫´u Nhi√™n (5 c√¢u)</h2>
        <div id="quiz-area"></div>
        <button class="btn" onclick="grade('quiz')">N·ªôp B√†i</button>
        <button class="btn btn-reset" onclick="initQuiz()">ƒê·ªÅ m·ªõi ‚Üª</button>
        <div id="quiz-result" class="result-box"></div>
    </div>

    <div id="test" class="section">
        <h2>‚è±Ô∏è B√†i Ki·ªÉm Tra (10 c√¢u)</h2>
        <div id="test-area"></div>
        <button class="btn" onclick="grade('test')">N·ªôp B√†i</button>
        <button class="btn btn-reset" onclick="initTest()">ƒê·ªÅ m·ªõi ‚Üª</button>
        <div id="test-result" class="result-box"></div>
    </div>

    <div id="history" class="section">
        <h2>üìà L·ªãch s·ª≠ h·ªçc t·∫≠p</h2>
        <div id="history-content">
            <ul id="historyList" class="history-list"></ul>
            <button class="btn btn-reset" onclick="clearHistory()">X√≥a l·ªãch s·ª≠</button>
        </div>
    </div>
</main>

<script>
    const irregularVerbs = [
        { v1: "be", v2: "was/were", v3: "been", m: "th√¨, l√†, ·ªü", e: "I have been busy." },
        { v1: "begin", v2: "began", v3: "begun", m: "b·∫Øt ƒë·∫ßu", e: "The class began at 8." },
        { v1: "break", v2: "broke", v3: "broken", m: "l√†m v·ª°", e: "He broke the window." },
        { v1: "buy", v2: "bought", v3: "bought", m: "mua", e: "I bought a new book." },
        { v1: "do", v2: "did", v3: "done", m: "l√†m", e: "I did my homework." },
        { v1: "go", v2: "went", v3: "gone", m: "ƒëi", e: "She has gone out." },
        { v1: "know", v2: "knew", v3: "known", m: "bi·∫øt", e: "I knew the answer." }
        // B·∫°n c√≥ th·ªÉ th√™m ti·∫øp cho ƒë·ªß 360 t·ª´ v√†o ƒë√¢y
    ];

    const questionBank = [
        { q: "She _____ to the gym every day.", o: ["go", "goes", "going", "gone"], a: 1 },
        { q: "If it _____ sunny, we will go out.", o: ["is", "was", "were", "be"], a: 0 },
        { q: "The cake _____ by my mom yesterday.", o: ["is made", "was made", "made", "was make"], a: 1 },
        { q: "I have _____ this movie before.", o: ["see", "saw", "seen", "seeing"], a: 2 },
        { q: "They _____ football when I came.", o: ["play", "played", "were playing", "are playing"], a: 2 },
        { q: "He is the man _____ saved the boy.", o: ["who", "whom", "which", "whose"], a: 0 },
        { q: "Choose the different stress:", o: ["'happy", "'teacher", "be'gin", "'student"], a: 2 },
        { q: "Suffix -ed in 'stopped' is:", o: ["/id/", "/t/", "/d/", "/s/"], a: 1 }
    ];

    let qQuiz = [], qTest = [];

    window.onload = () => {
        loadVerbs();
        initQuiz();
        initTest();
        showHistory();
    };

    function loadVerbs() {
        document.getElementById('verbBody').innerHTML = irregularVerbs.map(v => 
            `<tr><td><b>${v.v1}</b></td><td>${v.v2}</td><td>${v.v3}</td><td>${v.m}</td><td style="font-style:italic">${v.e}</td></tr>`
        ).join('');
    }

    function searchVerbs() {
        let input = document.getElementById("verbSearch").value.toLowerCase();
        let rows = document.getElementById("verbBody").getElementsByTagName("tr");
        for (let row of rows) row.style.display = row.textContent.toLowerCase().includes(input) ? "" : "none";
    }

    function initQuiz() { qQuiz = getRandom(5); renderQs('quiz-area', qQuiz, 'q'); document.getElementById('quiz-result').style.display='none'; }
    function initTest() { qTest = getRandom(8); renderQs('test-area', qTest, 't'); document.getElementById('test-result').style.display='none'; }
    function getRandom(n) { return [...questionBank].sort(() => 0.5 - Math.random()).slice(0, n); }

    function renderQs(id, data, pre) {
        document.getElementById(id).innerHTML = data.map((item, i) => `
            <div class="question-block" id="${pre}-b-${i}">
                <strong>${i+1}. ${item.q}</strong>
                <div class="options-list">
                    ${item.o.map((opt, idx) => `<label><input type="radio" name="${pre}-${i}" value="${idx}"> ${opt}</label>`).join('')}
                </div>
                <div id="${pre}-f-${i}" style="font-weight:bold; margin-top:5px"></div>
            </div>`).join('');
    }

    function grade(type) {
        const data = type === 'quiz' ? qQuiz : qTest;
        const pre = type === 'quiz' ? 'q' : 't';
        let score = 0, complete = true;

        data.forEach((item, i) => {
            const sel = document.querySelector(`input[name="${pre}-${i}"]:checked`);
            const block = document.getElementById(`${pre}-b-${i}`);
            const fb = document.getElementById(`${pre}-f-${i}`);
            block.classList.remove('unanswered');
            if(!sel) { block.classList.add('unanswered'); complete = false; }
            else {
                if(parseInt(sel.value) === item.a) { score++; fb.innerHTML="‚úÖ"; fb.style.color="green"; }
                else { fb.innerHTML=`‚ùå (ƒê√∫ng: ${item.o[item.a]})`; fb.style.color="red"; }
            }
        });

        const res = document.getElementById(`${type}-result`);
        res.style.display = "block";
        if(complete) {
            res.innerHTML = `ƒêi·ªÉm c·ªßa b·∫°n: ${score}/${data.length}`;
            res.style.background = "#ecfdf5";
            saveToHistory(type, score, data.length);
        } else {
            res.innerHTML = "‚ö†Ô∏è H√£y ho√†n th√†nh c√°c c√¢u m√†u v√†ng!";
            res.style.background = "#fffbeb";
        }
    }

    // L∆ØU L·ªäCH S·ª¨
    function saveToHistory(type, s, t) {
        let history = JSON.parse(localStorage.getItem('eng_history')) || [];
        const record = {
            type: type.toUpperCase(),
            score: `${s}/${t}`,
            time: new Date().toLocaleString('vi-VN')
        };
        history.unshift(record);
        localStorage.setItem('eng_history', JSON.stringify(history.slice(0, 10))); // L∆∞u 10 b·∫£n ghi g·∫ßn nh·∫•t
        showHistory();
    }

    function showHistory() {
        let history = JSON.parse(localStorage.getItem('eng_history')) || [];
        const list = document.getElementById('historyList');
        if(history.length === 0) { list.innerHTML = "Ch∆∞a c√≥ d·ªØ li·ªáu."; return; }
        list.innerHTML = history.map(h => `
            <li class="history-item">
                <span><b>${h.type}</b>: ${h.score}</span>
                <span style="color:#999; font-size:0.8em">${h.time}</span>
            </li>
        `).join('');
    }

    function clearHistory() {
        if(confirm("X√≥a to√†n b·ªô l·ªãch s·ª≠?")) {
            localStorage.removeItem('eng_history');
            showHistory();
        }
    }

    function showTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }
</script>
</body>
</html>
