<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="site-title">English Practicing</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --bg: #f8fafc;
            --text: #334155;
            --correct: #16a34a;
            --wrong: #dc2626;
            --warning: #f59e0b;
        }

        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; background: var(--bg); color: var(--text); line-height: 1.6; }
        header { background: var(--primary); color: white; padding: 25px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        nav { display: flex; justify-content: center; background: var(--secondary); position: sticky; top: 0; z-index: 100; overflow-x: auto; }
        nav button { background: none; border: none; color: white; padding: 15px 20px; cursor: pointer; font-weight: 600; transition: 0.3s; white-space: nowrap; }
        nav button:hover, nav button.active { background: rgba(255,255,255,0.2); }

        main { max-width: 1000px; margin: 20px auto; padding: 20px; }
        .section { display: none; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .section.active { display: block; animation: slideUp 0.4s ease-out; }

        /* Ki·∫øn th·ª©c Trang ch·ªß */
        .knowledge-item { border: 1px solid #e2e8f0; border-radius: 10px; margin-bottom: 15px; }
        .knowledge-header { background: #f1f5f9; padding: 15px; cursor: pointer; font-weight: bold; display: flex; justify-content: space-between; border-radius: 10px; }
        .knowledge-content { padding: 20px; display: none; border-top: 1px solid #e2e8f0; }
        .knowledge-content.show { display: block; }

        /* Flashcard 3D */
        .flashcard-wrapper { perspective: 1000px; width: 300px; height: 200px; margin: 30px auto; cursor: pointer; }
        .flashcard-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-radius: 15px; }
        .flashcard-inner.flipped { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: bold; border-radius: 15px; padding: 20px; box-sizing: border-box; }
        .flashcard-front { background: linear-gradient(135deg, #60a5fa, #2563eb); color: white; }
        .flashcard-back { background: #16a34a; color: white; transform: rotateY(180deg); }

        /* Quiz & Test */
        .question-block { padding: 20px; border-radius: 10px; border: 2px solid #f1f5f9; margin-bottom: 20px; transition: 0.3s; }
        .unanswered { border-color: var(--warning); background-color: #fffbeb; }
        .options-list label { display: block; padding: 10px; cursor: pointer; border-radius: 6px; }
        .options-list label:hover { background: #eff6ff; }
        
        .btn { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 10px 5px; }
        .result-box { display: none; margin-top: 20px; padding: 20px; border-radius: 10px; text-align: center; font-size: 1.2rem; font-weight: bold; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<header>
    <h1 id="main-h1">ENGLISH PRACTICING</h1>
    <p id="main-desc">H·ªçc t·∫≠p th√¥ng minh - Thi c·ª≠ t·ª± tin</p>
</header>

<nav id="navbar">
    <button onclick="showTab('home')" class="nav-btn active" id="nav-home">Trang Ch·ªß</button>
    <button onclick="showTab('flashcard')" class="nav-btn" id="nav-fc">Flashcard</button>
    <button onclick="showTab('quiz')" class="nav-btn" id="nav-quiz">Luy·ªán T·∫≠p</button>
    <button onclick="showTab('test')" class="nav-btn" id="nav-test">B√†i Ki·ªÉm Tra</button>
</nav>

<main>
    <div id="home" class="section active">
        <h2 id="home-title">üìö Ki·∫øn Th·ª©c Tr·ªçng T√¢m</h2>
        <div id="knowledge-container"></div>
    </div>

    <div id="flashcard" class="section">
        <h2 id="fc-title">Th·∫ª T·ª´ V·ª±ng Th√¥ng Minh</h2>
        <div class="flashcard-wrapper" onclick="this.querySelector('.flashcard-inner').classList.toggle('flipped')">
            <div class="flashcard-inner">
                <div class="flashcard-front" id="fc-front">Loading...</div>
                <div class="flashcard-back" id="fc-back">Loading...</div>
            </div>
        </div>
        <div style="text-align: center;">
            <button class="btn" id="fc-next" onclick="nextCard()">T·ª´ ti·∫øp theo ‚û°</button>
        </div>
    </div>

    <div id="quiz" class="section">
        <h2 id="quiz-title">üìù Tr·∫Øc Nghi·ªám Nhanh</h2>
        <div id="quiz-area"></div>
        <button class="btn" id="btn-q-submit" onclick="grade('quiz')">N·ªôp B√†i</button>
        <div id="quiz-result" class="result-box"></div>
    </div>

    <div id="test" class="section">
        <h2 id="test-title">‚è±Ô∏è B√†i Ki·ªÉm Tra T·ªïng H·ª£p</h2>
        <div id="test-area"></div>
        <button class="btn" id="btn-t-submit" onclick="grade('test')">N·ªôp B√†i</button>
        <div id="test-result" class="result-box"></div>
    </div>
</main>

<script>
    const langData = {
        vi: {
            h1: "ENGLISH PRACTICING", desc: "H·ªçc t·∫≠p th√¥ng minh - Thi c·ª≠ t·ª± tin",
            nav: ["Trang Ch·ªß", "Flashcard", "Luy·ªán T·∫≠p", "B√†i Ki·ªÉm Tra"],
            homeItems: [
                { h: "1. Quy t·∫Øc ph√°t √¢m ƒëu√¥i -ED", c: "‚Ä¢ /id/: Sau t, d (wanted, decided)<br>‚Ä¢ /t/: Sau p, k, f, s, sh, ch (watched, stopped)<br>‚Ä¢ /d/: C√°c tr∆∞·ªùng h·ª£p c√≤n l·∫°i." },
                { h: "2. Quy t·∫Øc ph√°t √¢m ƒëu√¥i -S/ES", c: "‚Ä¢ /s/: Sau p, t, k, f, th.<br>‚Ä¢ /iz/: Sau s, ss, ch, sh, x, z, ge, ce.<br>‚Ä¢ /z/: C√°c tr∆∞·ªùng h·ª£p c√≤n l·∫°i." },
                { h: "3. Tr·ªçng √¢m t·ª´ 2 √¢m ti·∫øt", c: "‚Ä¢ Danh t·ª´ & T√≠nh t·ª´: Th∆∞·ªùng nh·∫•n √¢m 1 ('teacher, 'happy).<br>‚Ä¢ ƒê·ªông t·ª´: Th∆∞·ªùng nh·∫•n √¢m 2 (be'gin, re'lax)." }
            ],
            words: [
                { f: "Preserve (v)", b: "B·∫£o t·ªìn, g√¨n gi·ªØ" },
                { f: "Innovation (n)", b: "S·ª± ƒë·ªïi m·ªõi" },
                { f: "Sustainable (adj)", b: "B·ªÅn v·ªØng" }
            ],
            warn: "‚ö†Ô∏è B·∫°n ch∆∞a ho√†n th√†nh c√°c c√¢u m√†u v√†ng!",
            score: "K·∫øt qu·∫£: {s}/{t} c√¢u ƒë√∫ng.",
            questions: [{ q: "Ph√°t √¢m -ed n√†o kh√°c?", o: ["worked", "watched", "cleaned", "stopped"], a: 2 }],
            testQs: [
                { q: "If I were you, I _____ that job.", o: ["will take", "would take", "take", "took"], a: 1 },
                { q: "The man _____ lives next door is a doctor.", o: ["whom", "which", "whose", "who"], a: 3 }
            ]
        },
        en: {
            h1: "ENGLISH PRACTICING", desc: "Learn Smart - Test with Confidence",
            nav: ["Home", "Flashcards", "Practice", "Mock Test"],
            homeItems: [
                { h: "1. Pronunciation of -ED", c: "‚Ä¢ /id/: After t, d.<br>‚Ä¢ /t/: After p, k, f, s, sh, ch.<br>‚Ä¢ /d/: Other cases." },
                { h: "2. Pronunciation of -S/ES", c: "‚Ä¢ /s/: After p, t, k, f, th.<br>‚Ä¢ /iz/: After s, ss, ch, sh, x, z, ge, ce.<br>‚Ä¢ /z/: Other cases." },
                { h: "3. Stress in 2-syllable words", c: "‚Ä¢ Nouns & Adjs: Usually 1st syllable.<br>‚Ä¢ Verbs: Usually 2nd syllable." }
            ],
            words: [
                { f: "Preserve (v)", b: "To keep something safe" },
                { f: "Innovation (n)", b: "A new method or idea" },
                { f: "Sustainable (adj)", b: "Able to continue for a long time" }
            ],
            warn: "‚ö†Ô∏è Please complete the yellow questions!",
            score: "Score: {s}/{t} correct answers.",
            questions: [{ q: "Which -ed is different?", o: ["worked", "watched", "cleaned", "stopped"], a: 2 }],
            testQs: [
                { q: "If I were you, I _____ that job.", o: ["will take", "would take", "take", "took"], a: 1 },
                { q: "The man _____ lives next door is a doctor.", o: ["whom", "which", "whose", "who"], a: 3 }
            ]
        }
    };

    let currentLang = 'vi';
    let cardIdx = 0;

    async function init() {
        try {
            const res = await fetch('https://ipapi.co/json/');
            const data = await res.json();
            if (['US', 'GB', 'AU', 'CA'].includes(data.country_code)) {
                if(confirm("Do you want to switch to English?")) currentLang = 'en';
            }
        } catch(e) {}
        render();
    }

    function render() {
        const d = langData[currentLang];
        document.getElementById('site-title').innerText = d.h1;
        document.getElementById('main-h1').innerText = d.h1;
        document.getElementById('main-desc').innerText = d.desc;
        document.querySelectorAll('.nav-btn').forEach((b, i) => b.innerText = d.nav[i]);
        
        document.getElementById('knowledge-container').innerHTML = d.homeItems.map(i => `
            <div class="knowledge-item">
                <div class="knowledge-header" onclick="this.nextElementSibling.classList.toggle('show')">${i.h} <span>‚ñº</span></div>
                <div class="knowledge-content">${i.c}</div>
            </div>`).join('');

        updateCard();
        renderQs('quiz-area', d.questions, 'q');
        renderQs('test-area', d.testQs, 't');
    }

    function updateCard() {
        const word = langData[currentLang].words[cardIdx];
        document.getElementById('fc-front').innerText = word.f;
        document.getElementById('fc-back').innerText = word.b;
    }

    function nextCard() {
        cardIdx = (cardIdx + 1) % langData[currentLang].words.length;
        document.querySelector('.flashcard-inner').classList.remove('flipped');
        setTimeout(updateCard, 200);
    }

    function renderQs(id, data, pre) {
        document.getElementById(id).innerHTML = data.map((item, i) => `
            <div class="question-block" id="${pre}-b-${i}">
                <strong>${i+1}. ${item.q}</strong>
                <div class="options-list">
                    ${item.o.map((opt, idx) => `<label><input type="radio" name="${pre}-${i}" value="${idx}"> ${opt}</label>`).join('')}
                </div>
                <div id="${pre}-f-${i}" style="margin-top:10px; font-weight:bold"></div>
            </div>`).join('');
    }

    function grade(type) {
        const d = langData[currentLang];
        const data = type === 'quiz' ? d.questions : d.testQs;
        const pre = type === 'quiz' ? 'q' : 't';
        let score = 0, complete = true;

        data.forEach((item, i) => {
            const sel = document.querySelector(`input[name="${pre}-${i}"]:checked`);
            const block = document.getElementById(`${pre}-b-${i}`);
            const fb = document.getElementById(`${pre}-f-${i}`);
            block.classList.remove('unanswered');

            if (!sel) { block.classList.add('unanswered'); complete = false; }
            else {
                if (parseInt(sel.value) === item.a) { fb.innerHTML = "‚úÖ Correct!"; fb.style.color = "green"; score++; }
                else { fb.innerHTML = `‚ùå Wrong! (${item.o[item.a]})`; fb.style.color = "red"; }
            }
        });

        const res = document.getElementById(`${type}-result`);
        res.style.display = "block";
        res.innerText = complete ? d.score.replace('{s}', score).replace('{t}', data.length) : d.warn;
        res.style.background = complete ? "#ecfdf5" : "#fffbeb";
    }

    function showTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    window.onload = init;
</script>
</body>
</html>
